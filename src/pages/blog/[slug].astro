---
import Root from "@/layouts/Root.astro";
import {getCollection, getEntry} from "astro:content";
import {toPost} from "@/content";
import Article from "@/layouts/Article.astro";

export async function getStaticPaths() {
	const c = await getCollection("blog");
	return c.map((p) => ({params: {slug: p.slug}}));
}

const {slug} = Astro.params;
const entry = await getEntry("blog", slug);
const {Content, ...rest} = await entry.render();
const post = toPost(entry, rest);
const res = await fetch(slug);
if (res.status !== 200) return null;
const {views} = await res.json();
---

<Root>
	<Article post={post} views={views}>
		<Content />
	</Article>
</Root>
