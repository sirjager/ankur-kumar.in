---
import Root from "@/layouts/Root.astro";
import {getCollection, getEntry} from "astro:content";
import Article from "@/layouts/Article.astro";
import {getCategories, getTags, toPost, toPosts} from "@/content";

export async function getStaticPaths() {
	const c = await getCollection("blog");
	return c.map((p) => ({params: {slug: p.slug}}));
}

const {slug} = Astro.params;
const entry = await getEntry("blog", slug);
const {Content, ...rest} = await entry.render();
const post = toPost(entry, rest);

const collection = await getCollection("blog");
const posts = toPosts(collection);

const categories = getCategories(posts);
const tags = getTags(posts);
---

<Root title={post.title} description={post.description} image={post.banner}>
	<Article allPosts={posts} post={post} categories={categories} tags={tags}>
		<Content />
	</Article>
</Root>
