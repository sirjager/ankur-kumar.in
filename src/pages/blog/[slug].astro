---
import Root from "@/layouts/Root.astro";
import {getCollection, getEntry} from "astro:content";
import Article from "@/components/Article/Article.astro";
import {getCategories, getTags, toPost, toPosts} from "@/content";
import Discussions from "@/components/Article/Discussions.astro";

export async function getStaticPaths() {
	const c = await getCollection("blog");
	return c.map((p) => ({params: {slug: p.slug}}));
}

const {slug} = Astro.params;
const entry = await getEntry("blog", slug);
const {Content, ...rest} = await entry.render();
const post = toPost(entry, rest);

const collection = await getCollection("blog");
const posts = toPosts(collection);

const categories = getCategories(posts);
const tags = getTags(posts);
---

<Root title={post.title} description={post.description} image={post.banner}>
	<Article allPosts={posts} post={post} categories={categories} tags={tags}>
		<Content />
	</Article>
	<div
		class:list={[
			"relative isolate mt-28 grid @container",
			"gap-y-8 px-4 lg:gap-x-4 lg:px-0",
			"grid-cols-[1fr,min(640px,100%),1fr]",
			"lg:grid-cols-[1fr,minmax(auto,224px),min(540px,100%),minmax(360px,224px),1fr]",
			"[&>*]:col-start-1 lg:[&>*]:col-start-2",
		]}
	>
		<div class="col-span-3 lg:!col-end-5">
			<Discussions />
		</div>
	</div>
</Root>
