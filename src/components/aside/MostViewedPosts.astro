---

---

<script>
	import {getCollection} from "astro:content";
	import {toPosts, type Post} from "@/content";
	const collection = await getCollection("blog");
	const posts = toPosts(collection);
	const res = await fetch("/api/views");
	const all = await res.json();
	const sorted = all.sort((a: any, b: any) => b.views - a.views).slice(0, 4);
	const popular: Post[] = sorted.map((views: any) => posts.find((p: any) => p.slug === views.path));

	const ele = document.getElementById("most-viewed-posts");
	if (ele) {
		while (ele.firstChild) {
			ele.removeChild(ele.firstChild);
		}

		const container = document.createElement("div");
		container.classList.add("flex", "flex-col", "gap-2");

		popular.forEach((post) => {
			const link = document.createElement("a");
			link.href = `/blog/${post.slug}`;
			link.classList.add("group/title", "flex", "relative", "gap-2", "overflow-clip");

			const image = document.createElement("img");
			image.src = post.banner;
			image.alt = post.title;
			image.classList.add("h-16", "min-w-16", "rounded-box", "max-h-16", "w-16", "max-w-16");
			link.appendChild(image);

			const title = document.createElement("div");
			title.classList.add("line-clamp-2", "text-sm", "group-hover/title:underline");
			title.textContent = post.title;
			link.appendChild(title);

			container.appendChild(link);
		});

		ele.appendChild(container);
	}
</script>

<div
	class:list={[
		"group/card relative rounded-box",
		"border-2 border-base-content/20 hover:border-accent",
		"transition duration-300 ease-in-out",
	]}
>
	<div class:list={["relative mt-4 w-full"]}>
		<div class="absolute top-1/2 h-0.5 w-full bg-base-content/20"></div>
		<div
			class="absolute top-1/2 h-0.5 w-0 bg-accent transition-all duration-300 ease-in-out group-hover/card:w-full"
		>
		</div>
		<div class="w-fit select-none">
			<div class="relative ml-4 bg-base-100 px-2 text-sm font-bold uppercase">
				<svg
					xmlns="http://www.w3.org/2000/svg"
					class="mx-1 inline h-4 w-4 stroke-accent"
					viewBox="0 0 24 24"
					stroke-width="1.5"
					fill="none"
					stroke-linecap="round"
					stroke-linejoin="round"
				>
					<path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
					<path d="M3 17l6 -6l4 4l8 -8"></path>
					<path d="M14 7l7 0l0 7"></path>
				</svg>
				Most
			</div>
		</div>
	</div>

	<ul>
		<details open>
			<summary
				class="flex cursor-pointer select-none items-center pb-2 pl-6 pr-2 text-3xl font-bold uppercase text-accent"
			>
				Viewed
			</summary>

			<ul id="most-viewed-posts" class="flex flex-col gap-2 p-4">
				{
					Array.from({length: 4}).map(() => {
						return (
							<li class:list={["group/title flex gap-2 overflow-clip"]}>
								<div class="skeleton h-16 max-h-16 w-16 min-w-16 max-w-16" />
								<div class="relative w-full space-y-1">
									<div class="skeleton h-4 w-full" />
									<div class="skeleton h-4 w-3/4" />
									<div class="skeleton h-4 w-1/2" />
								</div>
							</li>
						);
					})
				}
			</ul>
		</details>
	</ul>
</div>
